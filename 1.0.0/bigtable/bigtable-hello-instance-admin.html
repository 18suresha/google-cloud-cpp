<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Google Cloud Bigtable C++ Client: Example: C++ Hello World for Instance Admin</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Google Cloud Bigtable C++ Client
   &#160;<span id="projectnumber">0.10.0</span>
   </div>
   <div id="projectbrief">A C++ Client Library for Google Cloud Bigtable</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Example: C++ Hello World for Instance Admin </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example is a very simple "Instance Admin" application, which illustrates how to:</p>
<ul>
<li>Create a production instance.</li>
<li>List the existing instances.</li>
<li>Get the metadata for an instance.</li>
<li>List all the clusters in an instance.</li>
<li>Delete an instance.</li>
</ul>
<h2>Run the example</h2>
<p>This example uses the <a href="https://googleapis.github.io/google-cloud-cpp">Cloud Bigtable C++ Client Library</a> to communicate with Cloud Bigtable.</p>
<p>To run the example program, follow the <a href="https://github.com/googleapis/google-cloud-cpp/tree/master/google/cloud/bigtable/examples/">instructions</a> for the example on GitHub.</p>
<h2>Include the Necessary Headers</h2>
<p>The example uses the following headers:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="instance__admin_8h.html">google/cloud/bigtable/instance_admin.h</a>&quot;</span></div></div><!-- fragment --> <h2>Define aliases</h2>
<p>To make the example less verbose we define some aliases:</p>
<div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1bigtable.html">cbt</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1bigtable.html">google::cloud::bigtable</a>;</div><div class="line">  <span class="keyword">using</span> google::cloud::future;</div><div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div></div><!-- fragment --> <h2>Connect to the Cloud Bigtable instance admin endpoint.</h2>
<p>Create an object of type <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v0_1_1InstanceAdmin.html">bigtable::InstanceAdmin</a> to obtain information about <em>Instances</em>, <em>Clusters</em>, <em>Application Profiles</em>, and to change the <em>IAM permissions</em> in a Cloud Bigtable instance:</p>
<div class="fragment"><div class="line">  cbt::InstanceAdmin instance_admin(</div><div class="line">      <a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v0.html#a8a3eea1be7828d4afb6434f1ecc0b837">cbt::CreateDefaultInstanceAdminClient</a>(project_id, cbt::ClientOptions()));</div></div><!-- fragment --> <dl class="section see"><dt>See also</dt><dd><a href="https://cloud.google.com/bigtable/docs/instances-clusters-nodes">https://cloud.google.com/bigtable/docs/instances-clusters-nodes</a> for more information about Cloud Bigtable instances, clusters, and nodes. </dd>
<dd>
<a href="https://cloud.google.com/bigtable/docs/app-profiles">https://cloud.google.com/bigtable/docs/app-profiles</a> for more information about Cloud Bigtable application profiles. </dd>
<dd>
<a href="https://cloud.google.com/bigtable/docs/access-control">https://cloud.google.com/bigtable/docs/access-control</a> for more information access controls via IAM permissions on Cloud Bigtable.</dd></dl>
<h2>Check if an Instance already exists</h2>
<div class="fragment"><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nCheck Instance exists:\n&quot;</span>;</div><div class="line">  StatusOr&lt;cbt::InstanceList&gt; instances = instance_admin.ListInstances();</div><div class="line">  <span class="keywordflow">if</span> (!instances) {</div><div class="line">    <span class="keywordflow">throw</span> std::runtime_error(instances.status().message());</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (!instances-&gt;failed_locations.empty()) {</div><div class="line">    std::cerr</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;The service tells us it has no information about these locations:&quot;</span>;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; failed_location : instances-&gt;failed_locations) {</div><div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; failed_location;</div><div class="line">    }</div><div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;. Continuing anyway\n&quot;</span>;</div><div class="line">  }</div><div class="line">  <span class="keyword">auto</span> instance_name =</div><div class="line">      instance_admin.project_name() + <span class="stringliteral">&quot;/instances/&quot;</span> + instance_id;</div><div class="line">  <span class="keyword">auto</span> instance_name_it = std::find_if(</div><div class="line">      instances-&gt;instances.begin(), instances-&gt;instances.end(),</div><div class="line">      [&amp;instance_name](<a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v0.html#a6fd9b4a69047dfdcd3e57799ff905a8a">google::bigtable::admin::v2::Instance</a> <span class="keyword">const</span>&amp; i) {</div><div class="line">        <span class="keywordflow">return</span> i.name() == instance_name;</div><div class="line">      });</div><div class="line">  <span class="keywordtype">bool</span> instance_exists = instance_name_it != instances-&gt;instances.end();</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;The instance &quot;</span> &lt;&lt; instance_id</div><div class="line">            &lt;&lt; (instance_exists ? <span class="stringliteral">&quot;does&quot;</span> : <span class="stringliteral">&quot;does not&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; exist already\n&quot;</span>;</div></div><!-- fragment --> <dl class="section see"><dt>See also</dt><dd><a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v0_1_1InstanceAdmin.html#a55d5daa968557296320a8251bb0ae1ec">InstanceAdmin::GetInstance()</a> for another operation to query if an instance exists.</dd></dl>
<h2>Create a Production Instance</h2>
<p>Use <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v0_1_1InstanceAdmin.html#a642849986a3e8c67b160d4e654d9a999">InstanceAdmin::CreateInstance()</a> to create a new instance:</p>
<div class="fragment"><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\nCreating a PRODUCTION Instance: &quot;</span>;</div><div class="line"></div><div class="line">    <span class="comment">// production instance needs at least 3 nodes</span></div><div class="line">    <span class="keyword">auto</span> cluster_config = cbt::ClusterConfig(zone, 3, cbt::ClusterConfig::HDD);</div><div class="line">    cbt::InstanceConfig config(<a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v0.html#aa9a2503f014b52ebb4ba4b2651070d71">cbt::InstanceId</a>(instance_id),</div><div class="line">                               <a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v0.html#aeb2a52a19595444371d7dc12350d3f63">cbt::DisplayName</a>(<span class="stringliteral">&quot;Sample Instance&quot;</span>),</div><div class="line">                               {{cluster_id, cluster_config}});</div><div class="line">    config.set_type(cbt::InstanceConfig::PRODUCTION);</div><div class="line"></div><div class="line">    google::cloud::future&lt;void&gt; creation_done =</div><div class="line">        instance_admin.CreateInstance(config).then(</div><div class="line">            [instance_id](</div><div class="line">                future&lt;StatusOr&lt;google::bigtable::admin::v2::Instance&gt;&gt; f) {</div><div class="line">              <span class="keyword">auto</span> instance = f.get();</div><div class="line">              <span class="keywordflow">if</span> (!instance) {</div><div class="line">                std::cerr &lt;&lt; <span class="stringliteral">&quot;Could not create instance &quot;</span> &lt;&lt; instance_id</div><div class="line">                          &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">                <span class="keywordflow">throw</span> std::runtime_error(instance.status().message());</div><div class="line">              }</div><div class="line">              std::cout &lt;&lt; <span class="stringliteral">&quot;Successfully created instance: &quot;</span></div><div class="line">                        &lt;&lt; instance-&gt;DebugString() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">            });</div><div class="line">    <span class="comment">// Note how this blocks until the instance is created, in production code</span></div><div class="line">    <span class="comment">// you may want to perform this task asynchronously.</span></div><div class="line">    creation_done.get();</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;DONE\n&quot;</span>;</div></div><!-- fragment --> <dl class="section see"><dt>See also</dt><dd><a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v0_1_1InstanceConfig.html">bigtable::InstanceConfig</a> to define the initial attributes of a new instance.</dd></dl>
<h2>List Instances in a Project</h2>
<p>Use <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v0_1_1InstanceAdmin.html#a560bc7eb9bbdc92d8afda323e0922a74">InstanceAdmin::ListInstances()</a> to list all the instances in the project:</p>
<div class="fragment"><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nListing Instances:\n&quot;</span>;</div><div class="line">  instances = instance_admin.ListInstances();</div><div class="line">  <span class="keywordflow">if</span> (!instances) {</div><div class="line">    <span class="keywordflow">throw</span> std::runtime_error(instances.status().message());</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (!instances-&gt;failed_locations.empty()) {</div><div class="line">    std::cerr</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;The service tells us it has no information about these locations:&quot;</span>;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; failed_location : instances-&gt;failed_locations) {</div><div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; failed_location;</div><div class="line">    }</div><div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;. Continuing anyway\n&quot;</span>;</div><div class="line">  }</div><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; instance : instances-&gt;instances) {</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; instance.name() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">  }</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;DONE\n&quot;</span>;</div></div><!-- fragment --> <dl class="section see"><dt>See also</dt><dd>The gRPC API documentation for <a href="https://cloud.google.com/bigtable/docs/reference/admin/rpc/google.bigtable.admin.v2#google.bigtable.admin.v2.ListInstancesResponse">ListInstances</a> has more details on when <code>failed_locations</code> might be populated.</dd></dl>
<h2>Get an Instance Metadata</h2>
<p>Use <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v0_1_1InstanceAdmin.html#a55d5daa968557296320a8251bb0ae1ec">InstanceAdmin::GetInstance()</a> to retrieve the metadata of an instance:</p>
<div class="fragment"><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nGet Instance:\n&quot;</span>;</div><div class="line">  <span class="keyword">auto</span> instance = instance_admin.GetInstance(instance_id);</div><div class="line">  <span class="keywordflow">if</span> (!instance) {</div><div class="line">    <span class="keywordflow">throw</span> std::runtime_error(instance.status().message());</div><div class="line">  }</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Instance details :\n&quot;</span> &lt;&lt; instance-&gt;DebugString() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div></div><!-- fragment --> <h2>List clusters in an Instance</h2>
<p>Use <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v0_1_1InstanceAdmin.html#a92bc59bb5c428a77bfd34c5a0a39b1e2">InstanceAdmin::ListClusters()</a> to list all the clusters in an instance (or all the clusters in a project):</p>
<div class="fragment"><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nListing Clusters:\n&quot;</span>;</div><div class="line">  StatusOr&lt;cbt::ClusterList&gt; cluster_list =</div><div class="line">      instance_admin.ListClusters(instance_id);</div><div class="line">  <span class="keywordflow">if</span> (!cluster_list) {</div><div class="line">    <span class="keywordflow">throw</span> std::runtime_error(cluster_list.status().message());</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (!cluster_list-&gt;failed_locations.empty()) {</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;The Cloud Bigtable service reports that the following &quot;</span></div><div class="line">                 <span class="stringliteral">&quot;locations are temporarily unavailable and no information &quot;</span></div><div class="line">                 <span class="stringliteral">&quot;about clusters in these locations can be obtained:\n&quot;</span>;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; failed_location : cluster_list-&gt;failed_locations) {</div><div class="line">      std::cout &lt;&lt; failed_location &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">    }</div><div class="line">  }</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Cluster Name List:\n&quot;</span>;</div><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; cluster : cluster_list-&gt;clusters) {</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Cluster Name: &quot;</span> &lt;&lt; cluster.name() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">  }</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;DONE\n&quot;</span>;</div></div><!-- fragment --> <dl class="section see"><dt>See also</dt><dd>The <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v0_1_1InstanceAdmin.html">bigtable::InstanceAdmin</a> class also has functions to <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v0_1_1InstanceAdmin.html#a20ff5a065242ca9b552049b9b1a0e0b3">create</a>, <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v0_1_1InstanceAdmin.html#abd851711d3d5dce20cc195e9cd1c4bcf">update</a>, <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v0_1_1InstanceAdmin.html#a911a3dfc283d37ec580797ce126b2bc4">delete</a>, and <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v0_1_1InstanceAdmin.html#abd851711d3d5dce20cc195e9cd1c4bcf">retrieve the metadata</a> of a Cluster. </dd>
<dd>
The gRPC API documentation for <a href="https://cloud.google.com/bigtable/docs/reference/admin/rpc/google.bigtable.admin.v2#google.bigtable.admin.v2.ListClustersResponse">ListClusters</a> has more details on when <code>failed_locations</code> might be populated.</dd></dl>
<h2>Delete an instance</h2>
<p>Finally, use <a class="el" href="classgoogle_1_1cloud_1_1bigtable_1_1v0_1_1InstanceAdmin.html#ab7de1ee5392dfccc006218f0abb83118">InstanceAdmin::DeleteInstance()</a> to delete an instance:</p>
<div class="fragment"><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Deleting instance &quot;</span> &lt;&lt; instance_id &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">  google::cloud::Status delete_status =</div><div class="line">      instance_admin.DeleteInstance(instance_id);</div><div class="line">  <span class="keywordflow">if</span> (!delete_status.ok()) {</div><div class="line">    <span class="keywordflow">throw</span> std::runtime_error(delete_status.message());</div><div class="line">  }</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;DONE\n&quot;</span>;</div></div><!-- fragment --> <dl class="section warning"><dt>Warning</dt><dd>Note that this function will delete the instance even if it contains tables with data in them. For mission critical data you must ensure that the data is backed up before calling this function.</dd></dl>
<h2>Put it all together</h2>
<p>Here is the full example</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="instance__admin_8h.html">google/cloud/bigtable/instance_admin.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="bigtable__hello__app__profile_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) <span class="keyword">try</span> {</div><div class="line">  <span class="keywordflow">if</span> (argc != 5) {</div><div class="line">    std::string <span class="keyword">const</span> cmd = argv[0];</div><div class="line">    <span class="keyword">auto</span> last_slash = std::string(cmd).find_last_of(<span class="charliteral">&#39;/&#39;</span>);</div><div class="line">    <span class="keyword">auto</span> program = cmd.substr(last_slash + 1);</div><div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;\nUsage: &quot;</span> &lt;&lt; program</div><div class="line">              &lt;&lt; <span class="stringliteral">&quot; &lt;project-id&gt; &lt;instance-id&gt; &lt;cluster-id&gt; &lt;zone&gt;\n\n&quot;</span></div><div class="line">              &lt;&lt; <span class="stringliteral">&quot;Example: &quot;</span> &lt;&lt; program</div><div class="line">              &lt;&lt; <span class="stringliteral">&quot; my-project my-instance my-instance-c1 us-central1-f\n&quot;</span>;</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">  }</div><div class="line"></div><div class="line">  std::string <span class="keyword">const</span> project_id = argv[1];</div><div class="line">  std::string <span class="keyword">const</span> instance_id = argv[2];</div><div class="line">  std::string <span class="keyword">const</span> cluster_id = argv[3];</div><div class="line">  std::string <span class="keyword">const</span> zone = argv[4];</div><div class="line"></div><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1bigtable.html">cbt</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1bigtable.html">google::cloud::bigtable</a>;</div><div class="line">  <span class="keyword">using</span> google::cloud::future;</div><div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div><div class="line"></div><div class="line">  <span class="comment">// Connect to the Cloud Bigtable admin endpoint.</span></div><div class="line"><span class="comment"></span>  cbt::InstanceAdmin instance_admin(</div><div class="line">      <a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v0.html#a8a3eea1be7828d4afb6434f1ecc0b837">cbt::CreateDefaultInstanceAdminClient</a>(project_id, cbt::ClientOptions()));</div><div class="line"></div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nCheck Instance exists:\n&quot;</span>;</div><div class="line">  StatusOr&lt;cbt::InstanceList&gt; instances = instance_admin.ListInstances();</div><div class="line">  <span class="keywordflow">if</span> (!instances) {</div><div class="line">    <span class="keywordflow">throw</span> std::runtime_error(instances.status().message());</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (!instances-&gt;failed_locations.empty()) {</div><div class="line">    std::cerr</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;The service tells us it has no information about these locations:&quot;</span>;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; failed_location : instances-&gt;failed_locations) {</div><div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; failed_location;</div><div class="line">    }</div><div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;. Continuing anyway\n&quot;</span>;</div><div class="line">  }</div><div class="line">  <span class="keyword">auto</span> instance_name =</div><div class="line">      instance_admin.project_name() + <span class="stringliteral">&quot;/instances/&quot;</span> + instance_id;</div><div class="line">  <span class="keyword">auto</span> instance_name_it = std::find_if(</div><div class="line">      instances-&gt;instances.begin(), instances-&gt;instances.end(),</div><div class="line">      [&amp;instance_name](<a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v0.html#a6fd9b4a69047dfdcd3e57799ff905a8a">google::bigtable::admin::v2::Instance</a> <span class="keyword">const</span>&amp; i) {</div><div class="line">        <span class="keywordflow">return</span> i.name() == instance_name;</div><div class="line">      });</div><div class="line">  <span class="keywordtype">bool</span> instance_exists = instance_name_it != instances-&gt;instances.end();</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;The instance &quot;</span> &lt;&lt; instance_id</div><div class="line">            &lt;&lt; (instance_exists ? <span class="stringliteral">&quot;does&quot;</span> : <span class="stringliteral">&quot;does not&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; exist already\n&quot;</span>;</div><div class="line"></div><div class="line">  <span class="comment">// Create instance if does not exists</span></div><div class="line">  <span class="keywordflow">if</span> (!instance_exists) {</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\nCreating a PRODUCTION Instance: &quot;</span>;</div><div class="line"></div><div class="line">    <span class="comment">// production instance needs at least 3 nodes</span></div><div class="line">    <span class="keyword">auto</span> cluster_config = cbt::ClusterConfig(zone, 3, cbt::ClusterConfig::HDD);</div><div class="line">    cbt::InstanceConfig config(<a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v0.html#aa9a2503f014b52ebb4ba4b2651070d71">cbt::InstanceId</a>(instance_id),</div><div class="line">                               <a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v0.html#aeb2a52a19595444371d7dc12350d3f63">cbt::DisplayName</a>(<span class="stringliteral">&quot;Sample Instance&quot;</span>),</div><div class="line">                               {{cluster_id, cluster_config}});</div><div class="line">    config.set_type(cbt::InstanceConfig::PRODUCTION);</div><div class="line"></div><div class="line">    google::cloud::future&lt;void&gt; creation_done =</div><div class="line">        instance_admin.CreateInstance(config).then(</div><div class="line">            [instance_id](</div><div class="line">                future&lt;StatusOr&lt;google::bigtable::admin::v2::Instance&gt;&gt; f) {</div><div class="line">              <span class="keyword">auto</span> instance = f.get();</div><div class="line">              <span class="keywordflow">if</span> (!instance) {</div><div class="line">                std::cerr &lt;&lt; <span class="stringliteral">&quot;Could not create instance &quot;</span> &lt;&lt; instance_id</div><div class="line">                          &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">                <span class="keywordflow">throw</span> std::runtime_error(instance.status().message());</div><div class="line">              }</div><div class="line">              std::cout &lt;&lt; <span class="stringliteral">&quot;Successfully created instance: &quot;</span></div><div class="line">                        &lt;&lt; instance-&gt;DebugString() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">            });</div><div class="line">    <span class="comment">// Note how this blocks until the instance is created, in production code</span></div><div class="line">    <span class="comment">// you may want to perform this task asynchronously.</span></div><div class="line">    creation_done.get();</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;DONE\n&quot;</span>;</div><div class="line">  }</div><div class="line"></div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nListing Instances:\n&quot;</span>;</div><div class="line">  instances = instance_admin.ListInstances();</div><div class="line">  <span class="keywordflow">if</span> (!instances) {</div><div class="line">    <span class="keywordflow">throw</span> std::runtime_error(instances.status().message());</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (!instances-&gt;failed_locations.empty()) {</div><div class="line">    std::cerr</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;The service tells us it has no information about these locations:&quot;</span>;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; failed_location : instances-&gt;failed_locations) {</div><div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; failed_location;</div><div class="line">    }</div><div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;. Continuing anyway\n&quot;</span>;</div><div class="line">  }</div><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; instance : instances-&gt;instances) {</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; instance.name() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">  }</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;DONE\n&quot;</span>;</div><div class="line"></div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nGet Instance:\n&quot;</span>;</div><div class="line">  <span class="keyword">auto</span> instance = instance_admin.GetInstance(instance_id);</div><div class="line">  <span class="keywordflow">if</span> (!instance) {</div><div class="line">    <span class="keywordflow">throw</span> std::runtime_error(instance.status().message());</div><div class="line">  }</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Instance details :\n&quot;</span> &lt;&lt; instance-&gt;DebugString() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"></div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;\nListing Clusters:\n&quot;</span>;</div><div class="line">  StatusOr&lt;cbt::ClusterList&gt; cluster_list =</div><div class="line">      instance_admin.ListClusters(instance_id);</div><div class="line">  <span class="keywordflow">if</span> (!cluster_list) {</div><div class="line">    <span class="keywordflow">throw</span> std::runtime_error(cluster_list.status().message());</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (!cluster_list-&gt;failed_locations.empty()) {</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;The Cloud Bigtable service reports that the following &quot;</span></div><div class="line">                 <span class="stringliteral">&quot;locations are temporarily unavailable and no information &quot;</span></div><div class="line">                 <span class="stringliteral">&quot;about clusters in these locations can be obtained:\n&quot;</span>;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; failed_location : cluster_list-&gt;failed_locations) {</div><div class="line">      std::cout &lt;&lt; failed_location &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">    }</div><div class="line">  }</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Cluster Name List:\n&quot;</span>;</div><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; cluster : cluster_list-&gt;clusters) {</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Cluster Name: &quot;</span> &lt;&lt; cluster.name() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">  }</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;DONE\n&quot;</span>;</div><div class="line"></div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Deleting instance &quot;</span> &lt;&lt; instance_id &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">  google::cloud::Status delete_status =</div><div class="line">      instance_admin.DeleteInstance(instance_id);</div><div class="line">  <span class="keywordflow">if</span> (!delete_status.ok()) {</div><div class="line">    <span class="keywordflow">throw</span> std::runtime_error(delete_status.message());</div><div class="line">  }</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;DONE\n&quot;</span>;</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">} <span class="keywordflow">catch</span> (std::exception <span class="keyword">const</span>&amp; ex) {</div><div class="line">  std::cerr &lt;&lt; <span class="stringliteral">&quot;Standard C++ exception raised: &quot;</span> &lt;&lt; ex.what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">  <span class="keywordflow">return</span> 1;</div><div class="line">}</div></div><!-- fragment --></div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
