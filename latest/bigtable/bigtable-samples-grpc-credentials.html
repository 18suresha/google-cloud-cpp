<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Google Cloud Bigtable C++ Client: Example: Use Cloud Bigtable C++ client with various gRPC credential classes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Google Cloud Bigtable C++ Client
   &#160;<span id="projectnumber">1.19.0</span>
   </div>
   <div id="projectbrief">A C++ Client Library for Google Cloud Bigtable</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Example: Use Cloud Bigtable C++ client with various gRPC credential classes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Use gRPC Credential Classes with Cloud Bigtable C++ client</h1>
<h2>Before you begin</h2>
<h3>Set the Environment Variable</h3>
<p>There are many ways to authenticate with Google Cloud Platform, here we use the <code>GOOGLE_APPLICATION_CREDENTIALS</code> environment variable to setup authentication based on a key file:</p>
<p><code>export GOOGLE_APPLICATION_CREDENTIALS="[PATH]"</code></p>
<p>where [PATH] is file path for JSON file that contains either user account or Service account key. Please refer <a href="https://cloud.google.com/docs/authentication/getting-started">this link</a> for more details on Google Authentication.</p>
<h2>Use Access Token Credentials</h2>
<p>Acquire Access Token</p>
<p>Use <a href="https://cloud.google.com/sdk/gcloud/reference/beta/auth/application-default/print-access-token">gcloud</a> to acquire an Access Token</p>
<p>The following code shows how to use access token to connect to an <code>InstanceAdmin</code> endpoint.</p>
<div class="fragment"><div class="line">  [](std::string <span class="keyword">const</span>&amp; project_id, std::string <span class="keyword">const</span>&amp; instance_id,</div><div class="line">     std::string <span class="keyword">const</span>&amp; access_token) {</div><div class="line">    <span class="keyword">auto</span> call_credentials = grpc::AccessTokenCredentials(access_token);</div><div class="line">    <span class="keyword">auto</span> channel_credentials =</div><div class="line">        grpc::SslCredentials(grpc::SslCredentialsOptions());</div><div class="line">    <span class="keyword">auto</span> credentials = grpc::CompositeChannelCredentials(channel_credentials,</div><div class="line">                                                         call_credentials);</div><div class="line"></div><div class="line">    cbt::TableAdmin admin(<a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v1.html#af631d3074faac714f581dc63f40528e4">cbt::CreateDefaultAdminClient</a>(</div><div class="line">                              project_id, cbt::ClientOptions(credentials)),</div><div class="line">                          instance_id);</div><div class="line"></div><div class="line">    <span class="keyword">auto</span> tables = admin.ListTables(cbt::TableAdmin::NAME_ONLY);</div><div class="line">    <span class="keywordflow">if</span> (!tables) <span class="keywordflow">throw</span> std::runtime_error(tables.status().message());</div><div class="line">  }</div></div><!-- fragment --> <h2>Use Refresh Token Credentials</h2>
<p>Sample code to connect to InstanceAdmin endpoint</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="instance__admin_8h.html">google/cloud/bigtable/instance_admin.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="instance__admin__client_8h.html">google/cloud/bigtable/instance_admin_client.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="bigtable__grpc__credentials_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) <span class="keyword">try</span> {</div><div class="line">  std::string <span class="keyword">const</span> project_id = argv[1];</div><div class="line">  grpc::string refresh_token = R<span class="stringliteral">&quot;&quot;&quot;({</span></div><div class="line"><span class="stringliteral">      &quot;client_id&quot;: &quot;XXXXXX.apps.googleusercontent.com&quot;,</span></div><div class="line"><span class="stringliteral">      &quot;client_secret&quot;: &quot;&lt;actual secret here&gt;&quot;,</span></div><div class="line"><span class="stringliteral">      &quot;refresh_token&quot;: &quot;&lt;actual token value here&gt;&quot;,</span></div><div class="line"><span class="stringliteral">      &quot;type&quot;: &quot;authorized_user&quot;</span></div><div class="line"><span class="stringliteral">  })&quot;&quot;&quot;;</span></div><div class="line"><span class="stringliteral">  </span><span class="keyword">auto</span> call_credentials = grpc::GoogleRefreshTokenCredentials(refresh_token);</div><div class="line">  <span class="keyword">auto</span> channel_credentials = grpc::SslCredentials(grpc::SslCredentialsOptions());</div><div class="line">  <span class="keyword">auto</span> credentials = grpc::CompositeChannelCredentials(channel_credentials, call_credentials);</div><div class="line">  <span class="keyword">auto</span> instance_admin_client(</div><div class="line">      <a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v1.html#a065da25598f925993d74b7e42bbbb5ef">google::cloud::bigtable::CreateDefaultInstanceAdminClient</a>(</div><div class="line">          project_id, google::cloud::bigtable::ClientOptions(credentials)));</div><div class="line">  google::cloud::bigtable::InstanceAdmin instance_admin(instance_admin_client);</div><div class="line">  <span class="keyword">auto</span> instances = instance_admin.ListInstances();</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">} <span class="keywordflow">catch</span> (std::exception <span class="keyword">const</span>&amp; ex) {</div><div class="line">  std::cerr &lt;&lt; <span class="stringliteral">&quot;Standard C++ exception raised: &quot;</span> &lt;&lt; ex.what() &lt;&lt; std::endl;</div><div class="line">  <span class="keywordflow">return</span> 1;</div><div class="line">}</div></div><!-- fragment --><h2>Use JWT Access Token Credentials</h2>
<p>The following code shows how to use a JWT access token to connect to an <code>InstanceAdmin</code> endpoint.</p>
<div class="fragment"><div class="line">  [](std::string <span class="keyword">const</span>&amp; project_id, std::string <span class="keyword">const</span>&amp; instance_id,</div><div class="line">     std::string <span class="keyword">const</span>&amp; service_account_file_json) {</div><div class="line">    std::ifstream stream(service_account_file_json);</div><div class="line">    <span class="keywordflow">if</span> (!stream.is_open()) {</div><div class="line">      std::ostringstream os;</div><div class="line">      os &lt;&lt; <span class="stringliteral">&quot;JWTAccessToken(&quot;</span> &lt;&lt; service_account_file_json</div><div class="line">         &lt;&lt; <span class="stringliteral">&quot;): cannot open upload file source&quot;</span>;</div><div class="line">      <span class="keywordflow">throw</span> std::runtime_error(os.str());</div><div class="line">    }</div><div class="line">    std::string json_key(std::istreambuf_iterator&lt;char&gt;{stream}, {});</div><div class="line"></div><div class="line">    <span class="keyword">auto</span> call_credentials =</div><div class="line">        grpc::ServiceAccountJWTAccessCredentials(json_key, 6000);</div><div class="line">    <span class="keyword">auto</span> channel_credentials =</div><div class="line">        grpc::SslCredentials(grpc::SslCredentialsOptions());</div><div class="line">    <span class="keyword">auto</span> credentials = grpc::CompositeChannelCredentials(channel_credentials,</div><div class="line">                                                         call_credentials);</div><div class="line">    cbt::TableAdmin admin(<a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v1.html#af631d3074faac714f581dc63f40528e4">cbt::CreateDefaultAdminClient</a>(</div><div class="line">                              project_id, cbt::ClientOptions(credentials)),</div><div class="line">                          instance_id);</div><div class="line"></div><div class="line">    <span class="keyword">auto</span> tables = admin.ListTables(cbt::TableAdmin::NAME_ONLY);</div><div class="line">    <span class="keywordflow">if</span> (!tables) <span class="keywordflow">throw</span> std::runtime_error(tables.status().message());</div><div class="line">  }</div></div><!-- fragment --> <h2>Use Google Compute Engine Credentials</h2>
<p>The following code shows how to use a GCE credentials to connect to an <code>InstanceAdmin</code> endpoint.</p>
<div class="fragment"><div class="line">  [](std::string <span class="keyword">const</span>&amp; project_id, std::string <span class="keyword">const</span>&amp; instance_id) {</div><div class="line">    <span class="keyword">auto</span> call_credentials = grpc::GoogleComputeEngineCredentials();</div><div class="line">    <span class="keyword">auto</span> channel_credentials =</div><div class="line">        grpc::SslCredentials(grpc::SslCredentialsOptions());</div><div class="line">    <span class="keyword">auto</span> credentials = grpc::CompositeChannelCredentials(channel_credentials,</div><div class="line">                                                         call_credentials);</div><div class="line">    cbt::TableAdmin admin(<a class="code" href="namespacegoogle_1_1cloud_1_1bigtable_1_1v1.html#af631d3074faac714f581dc63f40528e4">cbt::CreateDefaultAdminClient</a>(</div><div class="line">                              project_id, cbt::ClientOptions(credentials)),</div><div class="line">                          instance_id);</div><div class="line"></div><div class="line">    <span class="keyword">auto</span> tables = admin.ListTables(cbt::TableAdmin::NAME_ONLY);</div><div class="line">    <span class="keywordflow">if</span> (!tables) <span class="keywordflow">throw</span> std::runtime_error(tables.status().message());</div><div class="line">  }</div></div><!-- fragment --><p> One may face "Request had insufficient authentication scopes." error while running above example. This might be due to disabled "Cloud API access scope" for Bigtable. This error can be removed by providing sufficient access as explained <a href="https://cloud.google.com/compute/docs/access/create-enable-service-accounts-for-instances#changeserviceaccountandscopes">here</a>.</p>
<h2>Use of IAM Credentials</h2>
<p>These credentials are not supported yet. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
