<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Google Cloud Pub/Sub C++ Client: google::cloud::pubsub::v1::Publisher Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Google Cloud Pub/Sub C++ Client
   &#160;<span id="projectnumber">1.20.0(Beta)</span>
   </div>
   <div id="projectbrief">A C++ Client Library for Google Cloud Pub/Sub</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacegoogle.html">google</a></li><li class="navelem"><a class="el" href="namespacegoogle_1_1cloud.html">cloud</a></li><li class="navelem"><a class="el" href="namespacegoogle_1_1cloud_1_1pubsub.html">pubsub</a></li><li class="navelem"><a class="el" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html">v1</a></li><li class="navelem"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">google::cloud::pubsub::v1::Publisher Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Publish messages to the Cloud Pub/Sub service.  
 <a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="publisher_8h_source.html">google/cloud/pubsub/publisher.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:adc81ab4359c06482a7c18c838e175bf1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#adc81ab4359c06482a7c18c838e175bf1">Publisher</a> (std::shared_ptr&lt; <a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherConnection.html">PublisherConnection</a> &gt; connection, <a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions.html">PublisherOptions</a> options={})</td></tr>
<tr class="separator:adc81ab4359c06482a7c18c838e175bf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0dc0f70e5df843780e63d556e450888"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#ab0dc0f70e5df843780e63d556e450888">Publisher</a> (<a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> const &amp;)=default</td></tr>
<tr class="separator:ab0dc0f70e5df843780e63d556e450888"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0cd6e436ef718ec543fd017b4ac5145"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#ad0cd6e436ef718ec543fd017b4ac5145">operator=</a> (<a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> const &amp;)=default</td></tr>
<tr class="separator:ad0cd6e436ef718ec543fd017b4ac5145"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0de1f7f19d30b5c27589f71fb849c245"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#a0de1f7f19d30b5c27589f71fb849c245">Publisher</a> (<a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> &amp;&amp;) noexcept=default</td></tr>
<tr class="separator:a0de1f7f19d30b5c27589f71fb849c245"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44075a2f7938200f8ebf5cd595294b4e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#a44075a2f7938200f8ebf5cd595294b4e">operator=</a> (<a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> &amp;&amp;) noexcept=default</td></tr>
<tr class="separator:a44075a2f7938200f8ebf5cd595294b4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ccf0e0fb70c6a82754718310344c30a"><td class="memItemLeft" align="right" valign="top">future&lt; StatusOr&lt; std::string &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#a8ccf0e0fb70c6a82754718310344c30a">Publish</a> (<a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Message.html">Message</a> m)</td></tr>
<tr class="memdesc:a8ccf0e0fb70c6a82754718310344c30a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Publishes a message to this publisher's topic.  <a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#a8ccf0e0fb70c6a82754718310344c30a">More...</a><br /></td></tr>
<tr class="separator:a8ccf0e0fb70c6a82754718310344c30a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9862f588e39e5816574403c7632fbfd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#aa9862f588e39e5816574403c7632fbfd">Flush</a> ()</td></tr>
<tr class="memdesc:aa9862f588e39e5816574403c7632fbfd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Forcibly publishes any batched messages.  <a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#aa9862f588e39e5816574403c7632fbfd">More...</a><br /></td></tr>
<tr class="separator:aa9862f588e39e5816574403c7632fbfd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2c48c47685da65d5c1336b8879913dd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#ab2c48c47685da65d5c1336b8879913dd">ResumePublish</a> (std::string ordering_key)</td></tr>
<tr class="memdesc:ab2c48c47685da65d5c1336b8879913dd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resumes publishing after an error.  <a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#ab2c48c47685da65d5c1336b8879913dd">More...</a><br /></td></tr>
<tr class="separator:ab2c48c47685da65d5c1336b8879913dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Publish messages to the Cloud Pub/Sub service. </p>
<p>This class is used to publish message to a given topic, with a fixed configuration such as credentials, batching, background threads, etc. Applications that publish messages to multiple topics need to create separate instances of this class. Applications wanting to publish events with different batching configuration also need to create separate instances.</p>
<dl class="section see"><dt>See also</dt><dd><a href="https://cloud.google.com/pubsub">https://cloud.google.com/pubsub</a> for an overview of the Cloud Pub/Sub service.</dd></dl>
<dl class="section user"><dt>Example</dt><dd><div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">pubsub</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">google::cloud::pubsub</a>;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::future;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div>
<div class="line">  [](<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">pubsub::Publisher</a> publisher) {</div>
<div class="line">    <span class="keyword">auto</span> message_id = publisher.Publish(</div>
<div class="line">        <a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html">pubsub::MessageBuilder</a>{}.<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#a2309c1df894c5d1625f5e49cf09d0d8e">SetData</a>(<span class="stringliteral">&quot;Hello World!&quot;</span>).<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#ac0c8dd77ea781ac4e226716b5458920d">Build</a>());</div>
<div class="line">    <span class="keyword">auto</span> done = message_id.then([](future&lt;StatusOr&lt;std::string&gt;&gt; f) {</div>
<div class="line">      <span class="keyword">auto</span> <span class="keywordtype">id</span> = f.get();</div>
<div class="line">      <span class="keywordflow">if</span> (!<span class="keywordtype">id</span>) <span class="keywordflow">throw</span> std::runtime_error(<span class="keywordtype">id</span>.status().message());</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Hello World! published with id=&quot;</span> &lt;&lt; *<span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    });</div>
<div class="line">    <span class="comment">// Block until the message is published</span></div>
<div class="line">    done.get();</div>
<div class="line">  }</div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>Message Ordering</dt><dd>A <code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html" title="Publish messages to the Cloud Pub/Sub service.">Publisher</a></code> configured to preserve message ordering will sequence the messages that share a common ordering key (see <code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#a50de751935290af6859ead10f699e6f4" title="Sets the ordering key to key.">MessageBuilder::SetOrderingKey()</a></code>). Messages will be batched by ordering key, and new batches will wait until the status of the previous batch is known. On an error, all pending and queued messages are discarded, and the publisher rejects any new messages for the ordering key that experienced problems. The application must call <code>Publisher::ResumePublishing()</code> to to restore publishing.</dd></dl>
<dl class="section user"><dt>Performance</dt><dd><code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html" title="Publish messages to the Cloud Pub/Sub service.">Publisher</a></code> objects are relatively cheap to create, copy, and move. However, each <code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html" title="Publish messages to the Cloud Pub/Sub service.">Publisher</a></code> object must be created with a <code>std::shared_ptr&lt;<a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherConnection.html" title="A connection to the Cloud Pub/Sub service to publish events.">PublisherConnection</a>&gt;</code>, which itself is relatively expensive to create. Therefore, connection instances should be shared when possible. See the <code><a class="el" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#aa422fd1bd6e184b76bee57e2a84c0417" title="Creates a new PublisherConnection object to work with Publisher.">MakePublisherConnection()</a></code> method and the <code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherConnection.html" title="A connection to the Cloud Pub/Sub service to publish events.">PublisherConnection</a></code> interface for more details.</dd></dl>
<dl class="section user"><dt>Thread Safety</dt><dd>Instances of this class created via copy-construction or copy-assignment share the underlying pool of connections. Access to these copies via multiple threads is guaranteed to work. Two threads operating on the same instance of this class is not guaranteed to work.</dd></dl>
<dl class="section user"><dt>Background Threads</dt><dd>This class uses the background threads configured via <code>ConnectionOptions</code>. Applications can create their own pool of background threads by (a) creating their own <a class="elRef" href="https://googleapis.dev/cpp/google-cloud-common/latest/classgoogle_1_1cloud_1_1v1_1_1CompletionQueue.html">google::cloud::v1::CompletionQueue</a>, (b) setting this completion queue in <code>pubsub::ConnectionOptions::DisableBackgroundThreads()</code>, and (c) attaching any number of threads to the completion queue.</dd></dl>
<dl class="section user"><dt>Example: using a custom thread pool</dt><dd><div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">pubsub</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">google::cloud::pubsub</a>;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::future;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div>
<div class="line">  [](std::string project_id, std::string topic_id) {</div>
<div class="line">    <span class="comment">// Create our own completion queue to run the background activity, such as</span></div>
<div class="line">    <span class="comment">// flushing the publisher.</span></div>
<div class="line">    google::cloud::CompletionQueue cq;</div>
<div class="line">    <span class="comment">// Setup one or more of threads to service this completion queue. These must</span></div>
<div class="line">    <span class="comment">// remain running until all the work is done.</span></div>
<div class="line">    std::vector&lt;std::thread&gt; tasks;</div>
<div class="line">    std::generate_n(std::back_inserter(tasks), 4, [&amp;cq] {</div>
<div class="line">      <span class="keywordflow">return</span> std::thread([cq]() <span class="keyword">mutable</span> { cq.Run(); });</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> topic = <a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Topic.html">pubsub::Topic</a>(std::move(project_id), std::move(topic_id));</div>
<div class="line">    <span class="keyword">auto</span> publisher = <a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">pubsub::Publisher</a>(<a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#aa422fd1bd6e184b76bee57e2a84c0417">pubsub::MakePublisherConnection</a>(</div>
<div class="line">        std::move(topic), <a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions.html">pubsub::PublisherOptions</a>{},</div>
<div class="line">        <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a6833bef0c593e2cfde6e1c9f2d745b94">pubsub::ConnectionOptions</a>{}.DisableBackgroundThreads(cq)));</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;future&lt;void&gt;&gt; ids;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">char</span> <span class="keyword">const</span>* data : {<span class="stringliteral">&quot;1&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>, <span class="stringliteral">&quot;3&quot;</span>, <span class="stringliteral">&quot;go!&quot;</span>}) {</div>
<div class="line">      ids.push_back(</div>
<div class="line">          publisher.Publish(<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html">pubsub::MessageBuilder</a>().<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#a2309c1df894c5d1625f5e49cf09d0d8e">SetData</a>(data).<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#ac0c8dd77ea781ac4e226716b5458920d">Build</a>())</div>
<div class="line">              .then([data](future&lt;StatusOr&lt;std::string&gt;&gt; f) {</div>
<div class="line">                auto s = f.get();</div>
<div class="line">                if (!s) return;</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;Sent &#39;&quot;</span> &lt;&lt; data &lt;&lt; <span class="stringliteral">&quot;&#39; (&quot;</span> &lt;&lt; *s &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line">              }));</div>
<div class="line">    }</div>
<div class="line">    publisher.Flush();</div>
<div class="line">    <span class="comment">// Block until they are actually sent.</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <span class="keywordtype">id</span> : ids) <span class="keywordtype">id</span>.get();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Shutdown the completion queue and join the threads</span></div>
<div class="line">    cq.Shutdown();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; t : tasks) <a class="codeRef" href="https://googleapis.dev/cpp/google-cloud-common/latest/log_8cc.html#abc5627fb346314b5f14b10bdb6542da7">t</a>.join();</div>
<div class="line">  }</div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>Asynchronous Functions</dt><dd>Some of the member functions in this class return a <code>future&lt;T&gt;</code> (or <code>future&lt;StatusOr&lt;T&gt;&gt;</code>) object. Readers are probably familiar with <a href="https://en.cppreference.com/w/cpp/thread/future"><code>std::future&lt;T&gt;</code></a>. Our version adds a <code>.then()</code> function to attach a callback to the future, which is invoked when the future is satisfied. This function returns a <code>future&lt;U&gt;</code> where <code>U</code> is the return value of the attached function. More details in the <a class="elRef" href="https://googleapis.dev/cpp/google-cloud-common/latest/classgoogle_1_1cloud_1_1v1_1_1future.html">google::cloud::v1::future</a> documentation.</dd></dl>
<dl class="section user"><dt>Error Handling</dt><dd>This class uses <code>StatusOr&lt;T&gt;</code> to report errors. When an operation fails to perform its work the returned <code>StatusOr&lt;T&gt;</code> contains the error details. If the <code>ok()</code> member function in the <code>StatusOr&lt;T&gt;</code> returns <code>true</code> then it contains the expected result. Please consult the <a class="elRef" href="https://googleapis.dev/cpp/google-cloud-common/latest/classgoogle_1_1cloud_1_1v1_1_1StatusOr.html">google::cloud::v1::StatusOr</a> documentation for more details.</dd></dl>
<dl class="section user"><dt>Batching Configuration Example</dt><dd><div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">pubsub</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">google::cloud::pubsub</a>;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::future;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div>
<div class="line">  [](std::string project_id, std::string topic_id) {</div>
<div class="line">    <span class="keyword">auto</span> topic = <a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Topic.html">pubsub::Topic</a>(std::move(project_id), std::move(topic_id));</div>
<div class="line">    <span class="comment">// By default the publisher will flush a batch after 10ms, after it contains</span></div>
<div class="line">    <span class="comment">// more than 100 message, or after it contains more than 1MiB of data,</span></div>
<div class="line">    <span class="comment">// whichever comes first. This changes those defaults.</span></div>
<div class="line">    <span class="keyword">auto</span> publisher = <a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">pubsub::Publisher</a>(<a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#aa422fd1bd6e184b76bee57e2a84c0417">pubsub::MakePublisherConnection</a>(</div>
<div class="line">        std::move(topic),</div>
<div class="line">        <a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions.html">pubsub::PublisherOptions</a>{}</div>
<div class="line">            .<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions.html#a4637a68ef22b47bd83936ceff5dc4199">set_maximum_hold_time</a>(std::chrono::milliseconds(20))</div>
<div class="line">            .set_maximum_batch_bytes(4 * 1024 * 1024L)</div>
<div class="line">            .set_maximum_batch_message_count(200),</div>
<div class="line">        <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a6833bef0c593e2cfde6e1c9f2d745b94">pubsub::ConnectionOptions</a>{}));</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;future&lt;void&gt;&gt; ids;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">char</span> <span class="keyword">const</span>* data : {<span class="stringliteral">&quot;1&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>, <span class="stringliteral">&quot;3&quot;</span>, <span class="stringliteral">&quot;go!&quot;</span>}) {</div>
<div class="line">      ids.push_back(</div>
<div class="line">          publisher.Publish(<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html">pubsub::MessageBuilder</a>().<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#a2309c1df894c5d1625f5e49cf09d0d8e">SetData</a>(data).<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#ac0c8dd77ea781ac4e226716b5458920d">Build</a>())</div>
<div class="line">              .then([data](future&lt;StatusOr&lt;std::string&gt;&gt; f) {</div>
<div class="line">                auto s = f.get();</div>
<div class="line">                if (!s) return;</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;Sent &#39;&quot;</span> &lt;&lt; data &lt;&lt; <span class="stringliteral">&quot;&#39; (&quot;</span> &lt;&lt; *s &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line">              }));</div>
<div class="line">    }</div>
<div class="line">    publisher.Flush();</div>
<div class="line">    <span class="comment">// Block until they are actually sent.</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <span class="keywordtype">id</span> : ids) <span class="keywordtype">id</span>.get();</div>
<div class="line">  }</div>
</div><!-- fragment --></dd></dl>

<p class="definition">Definition at line <a class="el" href="publisher_8h_source.html#l00097">97</a> of file <a class="el" href="publisher_8h_source.html">publisher.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="adc81ab4359c06482a7c18c838e175bf1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc81ab4359c06482a7c18c838e175bf1">&#9670;&nbsp;</a></span>Publisher() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">google::cloud::pubsub::v1::Publisher::Publisher </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherConnection.html">PublisherConnection</a> &gt;&#160;</td>
          <td class="paramname"><em>connection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions.html">PublisherOptions</a>&#160;</td>
          <td class="paramname"><em>options</em> = <code>{}</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="publisher_8cc_source.html#l00022">22</a> of file <a class="el" href="publisher_8cc_source.html">publisher.cc</a>.</p>

</div>
</div>
<a id="ab0dc0f70e5df843780e63d556e450888"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0dc0f70e5df843780e63d556e450888">&#9670;&nbsp;</a></span>Publisher() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">google::cloud::pubsub::v1::Publisher::Publisher </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> const &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a0de1f7f19d30b5c27589f71fb849c245"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0de1f7f19d30b5c27589f71fb849c245">&#9670;&nbsp;</a></span>Publisher() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">google::cloud::pubsub::v1::Publisher::Publisher </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> &amp;&amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aa9862f588e39e5816574403c7632fbfd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9862f588e39e5816574403c7632fbfd">&#9670;&nbsp;</a></span>Flush()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void google::cloud::pubsub::v1::Publisher::Flush </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Forcibly publishes any batched messages. </p>
<p>As applications can configure a <code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html" title="Publish messages to the Cloud Pub/Sub service.">Publisher</a></code> to buffer messages, it is sometimes useful to flush them before any of the normal criteria to send the RPCs is met.</p>
<dl class="section user"><dt>Idempotency</dt><dd>See the description in <code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#a8ccf0e0fb70c6a82754718310344c30a" title="Publishes a message to this publisher&#39;s topic.">Publish()</a></code>.</dd></dl>
<dl class="section user"><dt>Example</dt><dd><div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">pubsub</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">google::cloud::pubsub</a>;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::future;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div>
<div class="line">  [](<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">pubsub::Publisher</a> publisher) {</div>
<div class="line">    std::vector&lt;future&lt;void&gt;&gt; done;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i != 10; ++i) {</div>
<div class="line">      <span class="keyword">auto</span> message_id = publisher.Publish(</div>
<div class="line">          <a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html">pubsub::MessageBuilder</a>{}</div>
<div class="line">              .<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#a2309c1df894c5d1625f5e49cf09d0d8e">SetData</a>(<span class="stringliteral">&quot;Hello World! [&quot;</span> + std::to_string(i) + <span class="stringliteral">&quot;]&quot;</span>)</div>
<div class="line">              .<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#ae6d7e5810550fe1d7ead2e6c0617dd54">SetAttribute</a>(<span class="stringliteral">&quot;origin&quot;</span>, <span class="stringliteral">&quot;cpp-sample&quot;</span>)</div>
<div class="line">              .<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#ae6d7e5810550fe1d7ead2e6c0617dd54">SetAttribute</a>(<span class="stringliteral">&quot;username&quot;</span>, <span class="stringliteral">&quot;gcp&quot;</span>)</div>
<div class="line">              .<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#ac0c8dd77ea781ac4e226716b5458920d">Build</a>());</div>
<div class="line">      done.push_back(message_id.then([i](future&lt;StatusOr&lt;std::string&gt;&gt; f) {</div>
<div class="line">        auto id = f.get();</div>
<div class="line">        if (!id) throw std::runtime_error(id.status().message());</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Message &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; published with id=&quot;</span> &lt;&lt; *id &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">      }));</div>
<div class="line">    }</div>
<div class="line">    publisher.Flush();</div>
<div class="line">    <span class="comment">// Block until all the messages are published (optional)</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; f : done) f.get();</div>
<div class="line">  }</div>
</div><!-- fragment --> </dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function does not return any status or error codes, the application can use the <code>future&lt;StatusOr&lt;std::string&gt;&gt;</code> returned in each <code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#a8ccf0e0fb70c6a82754718310344c30a" title="Publishes a message to this publisher&#39;s topic.">Publish()</a></code> call to find out what the results are. </dd></dl>

<p class="definition">Definition at line <a class="el" href="publisher_8h_source.html#l00157">157</a> of file <a class="el" href="publisher_8h_source.html">publisher.h</a>.</p>

</div>
</div>
<a id="a44075a2f7938200f8ebf5cd595294b4e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44075a2f7938200f8ebf5cd595294b4e">&#9670;&nbsp;</a></span>operator=() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a>&amp; google::cloud::pubsub::v1::Publisher::operator= </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> &amp;&amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ad0cd6e436ef718ec543fd017b4ac5145"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0cd6e436ef718ec543fd017b4ac5145">&#9670;&nbsp;</a></span>operator=() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a>&amp; google::cloud::pubsub::v1::Publisher::operator= </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> const &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a8ccf0e0fb70c6a82754718310344c30a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ccf0e0fb70c6a82754718310344c30a">&#9670;&nbsp;</a></span>Publish()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">future&lt;StatusOr&lt;std::string&gt; &gt; google::cloud::pubsub::v1::Publisher::Publish </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Message.html">Message</a>&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Publishes a message to this publisher's topic. </p>
<p>Note that the message may be batched, depending on the <a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html" title="Publish messages to the Cloud Pub/Sub service.">Publisher</a>'s configuration. It could be delayed until the batch has enough messages, or enough data, or enough time has elapsed. See the <code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions.html" title="Configuration options for a Publisher.">PublisherOptions</a></code> documentation for more details.</p>
<dl class="section user"><dt>Idempotency</dt><dd>This is a non-idempotent operation, but the client library will automatically retry RPCs that fail with transient errors. As Cloud Pub/Sub has "at least once" delivery semantics applications are expected to handle duplicate messages without problems. The application can disable retries by changing the retry policy, please see the example below.</dd></dl>
<dl class="section user"><dt>Example</dt><dd><div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">pubsub</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">google::cloud::pubsub</a>;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::future;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div>
<div class="line">  [](<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">pubsub::Publisher</a> publisher) {</div>
<div class="line">    <span class="keyword">auto</span> message_id = publisher.Publish(</div>
<div class="line">        <a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html">pubsub::MessageBuilder</a>{}.<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#a2309c1df894c5d1625f5e49cf09d0d8e">SetData</a>(<span class="stringliteral">&quot;Hello World!&quot;</span>).<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#ac0c8dd77ea781ac4e226716b5458920d">Build</a>());</div>
<div class="line">    <span class="keyword">auto</span> done = message_id.then([](future&lt;StatusOr&lt;std::string&gt;&gt; f) {</div>
<div class="line">      <span class="keyword">auto</span> <span class="keywordtype">id</span> = f.get();</div>
<div class="line">      <span class="keywordflow">if</span> (!<span class="keywordtype">id</span>) <span class="keywordflow">throw</span> std::runtime_error(<span class="keywordtype">id</span>.status().message());</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Hello World! published with id=&quot;</span> &lt;&lt; *<span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    });</div>
<div class="line">    <span class="comment">// Block until the message is published</span></div>
<div class="line">    done.get();</div>
<div class="line">  }</div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>Disabling Retries Example</dt><dd><div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">pubsub</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">google::cloud::pubsub</a>;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::future;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div>
<div class="line">  [](std::string project_id, std::string topic_id) {</div>
<div class="line">    <span class="keyword">auto</span> topic = <a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Topic.html">pubsub::Topic</a>(std::move(project_id), std::move(topic_id));</div>
<div class="line">    <span class="keyword">auto</span> publisher = <a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">pubsub::Publisher</a>(<a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#aa422fd1bd6e184b76bee57e2a84c0417">pubsub::MakePublisherConnection</a>(</div>
<div class="line">        std::move(topic), <a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions.html">pubsub::PublisherOptions</a>{}, {},</div>
<div class="line">        <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a98e0197518e30291d1645bafdf7691a6">pubsub::LimitedErrorCountRetryPolicy</a>(<span class="comment">/*maximum_failures=*/</span>0).clone(),</div>
<div class="line">        <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a953aa9b925add24a5704b8a15749fe47">pubsub::ExponentialBackoffPolicy</a>(</div>
<div class="line">            <span class="comment">/*initial_delay=*/</span>std::chrono::milliseconds(200),</div>
<div class="line">            <span class="comment">/*maximum_delay=*/</span>std::chrono::seconds(45),</div>
<div class="line">            <span class="comment">/*scaling=*/</span>2.0)</div>
<div class="line">            .clone()));</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;future&lt;bool&gt;&gt; done;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">char</span> <span class="keyword">const</span>* data : {<span class="stringliteral">&quot;1&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>, <span class="stringliteral">&quot;3&quot;</span>, <span class="stringliteral">&quot;go!&quot;</span>}) {</div>
<div class="line">      done.push_back(</div>
<div class="line">          publisher.Publish(<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html">pubsub::MessageBuilder</a>().<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#a2309c1df894c5d1625f5e49cf09d0d8e">SetData</a>(data).<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#ac0c8dd77ea781ac4e226716b5458920d">Build</a>())</div>
<div class="line">              .then([](future&lt;StatusOr&lt;std::string&gt;&gt; f) {</div>
<div class="line">                return f.get().ok();</div>
<div class="line">              }));</div>
<div class="line">    }</div>
<div class="line">    publisher.Flush();</div>
<div class="line">    <span class="keywordtype">int</span> count = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; f : done) {</div>
<div class="line">      <span class="keywordflow">if</span> (f.get()) ++count;</div>
<div class="line">    }</div>
<div class="line">    std::cout &lt;&lt; count &lt;&lt; <span class="stringliteral">&quot; messages sent successfully\n&quot;</span>;</div>
<div class="line">  }</div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>Changing Retry Parameters Example</dt><dd><div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">pubsub</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">google::cloud::pubsub</a>;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::future;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div>
<div class="line">  [](std::string project_id, std::string topic_id) {</div>
<div class="line">    <span class="keyword">auto</span> topic = <a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Topic.html">pubsub::Topic</a>(std::move(project_id), std::move(topic_id));</div>
<div class="line">    <span class="comment">// By default a publisher will retry for 60 seconds, with an initial backoff</span></div>
<div class="line">    <span class="comment">// of 100ms, a maximum backoff of 60 seconds, and the backoff will grow by</span></div>
<div class="line">    <span class="comment">// 30% after each attempt. This changes those defaults.</span></div>
<div class="line">    <span class="keyword">auto</span> publisher = <a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">pubsub::Publisher</a>(<a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#aa422fd1bd6e184b76bee57e2a84c0417">pubsub::MakePublisherConnection</a>(</div>
<div class="line">        std::move(topic), <a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions.html">pubsub::PublisherOptions</a>{}, {},</div>
<div class="line">        <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a838db478485c19cba0f1e0e08ea30332">pubsub::LimitedTimeRetryPolicy</a>(</div>
<div class="line">            <span class="comment">/*maximum_duration=*/</span>std::chrono::minutes(10))</div>
<div class="line">            .clone(),</div>
<div class="line">        <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a953aa9b925add24a5704b8a15749fe47">pubsub::ExponentialBackoffPolicy</a>(</div>
<div class="line">            <span class="comment">/*initial_delay=*/</span>std::chrono::milliseconds(200),</div>
<div class="line">            <span class="comment">/*maximum_delay=*/</span>std::chrono::seconds(45),</div>
<div class="line">            <span class="comment">/*scaling=*/</span>2.0)</div>
<div class="line">            .clone()));</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;future&lt;bool&gt;&gt; done;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">char</span> <span class="keyword">const</span>* data : {<span class="stringliteral">&quot;1&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>, <span class="stringliteral">&quot;3&quot;</span>, <span class="stringliteral">&quot;go!&quot;</span>}) {</div>
<div class="line">      done.push_back(</div>
<div class="line">          publisher.Publish(<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html">pubsub::MessageBuilder</a>().<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#a2309c1df894c5d1625f5e49cf09d0d8e">SetData</a>(data).<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#ac0c8dd77ea781ac4e226716b5458920d">Build</a>())</div>
<div class="line">              .then([](future&lt;StatusOr&lt;std::string&gt;&gt; f) {</div>
<div class="line">                return f.get().ok();</div>
<div class="line">              }));</div>
<div class="line">    }</div>
<div class="line">    publisher.Flush();</div>
<div class="line">    <span class="keywordtype">int</span> count = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; f : done) {</div>
<div class="line">      <span class="keywordflow">if</span> (f.get()) ++count;</div>
<div class="line">    }</div>
<div class="line">    std::cout &lt;&lt; count &lt;&lt; <span class="stringliteral">&quot; messages sent successfully\n&quot;</span>;</div>
<div class="line">  }</div>
</div><!-- fragment --> </dd></dl>
<dl class="section return"><dt>Returns</dt><dd>a future that becomes satisfied when the message is published or on a unrecoverable error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="publisher_8h_source.html#l00136">136</a> of file <a class="el" href="publisher_8h_source.html">publisher.h</a>.</p>

</div>
</div>
<a id="ab2c48c47685da65d5c1336b8879913dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2c48c47685da65d5c1336b8879913dd">&#9670;&nbsp;</a></span>ResumePublish()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void google::cloud::pubsub::v1::Publisher::ResumePublish </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>ordering_key</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Resumes publishing after an error. </p>
<p>If the publisher options have message ordering enabled (see <code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions.html#a6061cfede61c452c63ac8637ebf7073a" title="Return true if message ordering is enabled.">PublisherOptions::message_ordering()</a></code>) all messages for a key that experience failure will be rejected until the application calls this function.</p>
<dl class="section user"><dt>Idempotency</dt><dd>This function never initiates a remote RPC, so there are no considerations around retrying it. Note, however, that more than one <code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#a8ccf0e0fb70c6a82754718310344c30a" title="Publishes a message to this publisher&#39;s topic.">Publish()</a></code> request may fail for the same ordering key. The application needs to call this function after <b>each</b> error before it can resume publishing messages with the same ordering key.</dd></dl>
<dl class="section user"><dt>Example</dt><dd><div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">pubsub</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">google::cloud::pubsub</a>;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::future;</div>
<div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div>
<div class="line">  [](<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">pubsub::Publisher</a> publisher) {</div>
<div class="line">    <span class="keyword">struct </span>SampleData {</div>
<div class="line">      std::string ordering_key;</div>
<div class="line">      std::string data;</div>
<div class="line">    } data[] = {</div>
<div class="line">        {<span class="stringliteral">&quot;key1&quot;</span>, <span class="stringliteral">&quot;message1&quot;</span>}, {<span class="stringliteral">&quot;key2&quot;</span>, <span class="stringliteral">&quot;message2&quot;</span>}, {<span class="stringliteral">&quot;key1&quot;</span>, <span class="stringliteral">&quot;message3&quot;</span>},</div>
<div class="line">        {<span class="stringliteral">&quot;key1&quot;</span>, <span class="stringliteral">&quot;message4&quot;</span>}, {<span class="stringliteral">&quot;key1&quot;</span>, <span class="stringliteral">&quot;message5&quot;</span>},</div>
<div class="line">    };</div>
<div class="line">    std::vector&lt;future&lt;void&gt;&gt; done;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; datum : data) {</div>
<div class="line">      <span class="keyword">auto</span> <span class="keyword">const</span>&amp; da = datum;  <span class="comment">// workaround MSVC lambda capture confusion</span></div>
<div class="line">      <span class="keyword">auto</span> handler = [da, publisher](future&lt;StatusOr&lt;std::string&gt;&gt; f) <span class="keyword">mutable</span> {</div>
<div class="line">        <span class="keyword">auto</span> <span class="keyword">const</span> msg = da.ordering_key + <span class="stringliteral">&quot;#&quot;</span> + da.data;</div>
<div class="line">        <span class="keyword">auto</span> <span class="keywordtype">id</span> = f.get();</div>
<div class="line">        <span class="keywordflow">if</span> (!<span class="keywordtype">id</span>) {</div>
<div class="line">          std::cout &lt;&lt; <span class="stringliteral">&quot;An error has occurred publishing &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">          publisher.ResumePublish(da.ordering_key);</div>
<div class="line">          <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Message &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot; published as id=&quot;</span> &lt;&lt; *<span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">      };</div>
<div class="line">      done.push_back(</div>
<div class="line">          publisher</div>
<div class="line">              .<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#a8ccf0e0fb70c6a82754718310344c30a">Publish</a>(<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html">pubsub::MessageBuilder</a>{}</div>
<div class="line">                           .<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#a2309c1df894c5d1625f5e49cf09d0d8e">SetData</a>(<span class="stringliteral">&quot;Hello World! [&quot;</span> + datum.data + <span class="stringliteral">&quot;]&quot;</span>)</div>
<div class="line">                           .<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#a50de751935290af6859ead10f699e6f4">SetOrderingKey</a>(datum.ordering_key)</div>
<div class="line">                           .<a class="code" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#ac0c8dd77ea781ac4e226716b5458920d">Build</a>())</div>
<div class="line">              .then(handler));</div>
<div class="line">    }</div>
<div class="line">    publisher.Flush();</div>
<div class="line">    <span class="comment">// Block until all the messages are published (optional)</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; f : done) f.get();</div>
<div class="line">  }</div>
</div><!-- fragment --></dd></dl>

<p class="definition">Definition at line <a class="el" href="publisher_8h_source.html#l00177">177</a> of file <a class="el" href="publisher_8h_source.html">publisher.h</a>.</p>

</div>
</div>
</div><!-- contents -->
<div class="ttc" id="aclassgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder_html"><div class="ttname"><a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html">google::cloud::pubsub::v1::MessageBuilder</a></div><div class="ttdoc">Constructs Message objects.</div><div class="ttdef"><b>Definition:</b> <a href="message_8h_source.html#l00142">message.h:142</a></div></div>
<div class="ttc" id="aclassgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher_html_a8ccf0e0fb70c6a82754718310344c30a"><div class="ttname"><a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#a8ccf0e0fb70c6a82754718310344c30a">google::cloud::pubsub::v1::Publisher::Publish</a></div><div class="ttdeci">future&lt; StatusOr&lt; std::string &gt; &gt; Publish(Message m)</div><div class="ttdoc">Publishes a message to this publisher's topic.</div><div class="ttdef"><b>Definition:</b> <a href="publisher_8h_source.html#l00136">publisher.h:136</a></div></div>
<div class="ttc" id="alog_8cc_html_abc5627fb346314b5f14b10bdb6542da7"><div class="ttname"><a href="https://googleapis.dev/cpp/google-cloud-common/latest/log_8cc.html#abc5627fb346314b5f14b10bdb6542da7">t</a></div><div class="ttdeci">absl::Time t</div></div>
<div class="ttc" id="aclassgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions_html"><div class="ttname"><a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions.html">google::cloud::pubsub::v1::PublisherOptions</a></div><div class="ttdoc">Configuration options for a Publisher.</div><div class="ttdef"><b>Definition:</b> <a href="publisher__options_8h_source.html#l00046">publisher_options.h:46</a></div></div>
<div class="ttc" id="anamespacegoogle_1_1cloud_1_1pubsub_1_1v1_html_aa422fd1bd6e184b76bee57e2a84c0417"><div class="ttname"><a href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#aa422fd1bd6e184b76bee57e2a84c0417">google::cloud::pubsub::v1::MakePublisherConnection</a></div><div class="ttdeci">std::shared_ptr&lt; PublisherConnection &gt; MakePublisherConnection(Topic topic, PublisherOptions options, ConnectionOptions connection_options, std::unique_ptr&lt; pubsub::RetryPolicy const &gt; retry_policy, std::unique_ptr&lt; pubsub::BackoffPolicy const &gt; backoff_policy)</div><div class="ttdoc">Creates a new PublisherConnection object to work with Publisher.</div><div class="ttdef"><b>Definition:</b> <a href="publisher__connection_8cc_source.html#l00067">publisher_connection.cc:67</a></div></div>
<div class="ttc" id="anamespacegoogle_1_1cloud_1_1pubsub_1_1v1_html_a6833bef0c593e2cfde6e1c9f2d745b94"><div class="ttname"><a href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a6833bef0c593e2cfde6e1c9f2d745b94">google::cloud::pubsub::v1::ConnectionOptions</a></div><div class="ttdeci">::google::cloud::ConnectionOptions&lt; ConnectionOptionsTraits &gt; ConnectionOptions</div><div class="ttdoc">Configure a connection for Cloud Pub/Sub services.</div><div class="ttdef"><b>Definition:</b> <a href="connection__options_8h_source.html#l00035">connection_options.h:36</a></div></div>
<div class="ttc" id="aclassgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Topic_html"><div class="ttname"><a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Topic.html">google::cloud::pubsub::v1::Topic</a></div><div class="ttdoc">Objects of this class identify a Cloud Pub/Sub topic.</div><div class="ttdef"><b>Definition:</b> <a href="topic_8h_source.html#l00036">topic.h:36</a></div></div>
<div class="ttc" id="aclassgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder_html_a50de751935290af6859ead10f699e6f4"><div class="ttname"><a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#a50de751935290af6859ead10f699e6f4">google::cloud::pubsub::v1::MessageBuilder::SetOrderingKey</a></div><div class="ttdeci">MessageBuilder &amp; SetOrderingKey(std::string key) &amp;</div><div class="ttdoc">Sets the ordering key to key.</div><div class="ttdef"><b>Definition:</b> <a href="message_8h_source.html#l00162">message.h:162</a></div></div>
<div class="ttc" id="aclassgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher_html"><div class="ttname"><a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">google::cloud::pubsub::v1::Publisher</a></div><div class="ttdoc">Publish messages to the Cloud Pub/Sub service.</div><div class="ttdef"><b>Definition:</b> <a href="publisher_8h_source.html#l00097">publisher.h:97</a></div></div>
<div class="ttc" id="anamespacegoogle_1_1cloud_1_1pubsub_1_1v1_html_a953aa9b925add24a5704b8a15749fe47"><div class="ttname"><a href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a953aa9b925add24a5704b8a15749fe47">google::cloud::pubsub::v1::ExponentialBackoffPolicy</a></div><div class="ttdeci">google::cloud::internal::ExponentialBackoffPolicy ExponentialBackoffPolicy</div><div class="ttdoc">A truncated exponential backoff policy with randomized periods.</div><div class="ttdef"><b>Definition:</b> <a href="backoff__policy_8h_source.html#l00030">backoff_policy.h:31</a></div></div>
<div class="ttc" id="anamespacegoogle_1_1cloud_1_1pubsub_html"><div class="ttname"><a href="namespacegoogle_1_1cloud_1_1pubsub.html">google::cloud::pubsub</a></div><div class="ttdoc">Contains all the Cloud Pubsub C++ client types and functions.</div><div class="ttdef"><b>Definition:</b> <a href="ack__handler_8cc_source.html#l00020">ack_handler.cc:20</a></div></div>
<div class="ttc" id="aclassgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder_html_ae6d7e5810550fe1d7ead2e6c0617dd54"><div class="ttname"><a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#ae6d7e5810550fe1d7ead2e6c0617dd54">google::cloud::pubsub::v1::MessageBuilder::SetAttribute</a></div><div class="ttdeci">MessageBuilder &amp; SetAttribute(std::string const &amp;key, std::string value) &amp;</div><div class="ttdoc">Inserts or sets an attribute on the message.</div><div class="ttdef"><b>Definition:</b> <a href="message_8h_source.html#l00190">message.h:190</a></div></div>
<div class="ttc" id="anamespacegoogle_1_1cloud_1_1pubsub_1_1v1_html_a98e0197518e30291d1645bafdf7691a6"><div class="ttname"><a href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a98e0197518e30291d1645bafdf7691a6">google::cloud::pubsub::v1::LimitedErrorCountRetryPolicy</a></div><div class="ttdeci">google::cloud::internal::LimitedErrorCountRetryPolicy&lt; pubsub_internal::RetryTraits &gt; LimitedErrorCountRetryPolicy</div><div class="ttdoc">A retry policy that limits the number of times a request can fail.</div><div class="ttdef"><b>Definition:</b> <a href="retry__policy_8h_source.html#l00053">retry_policy.h:55</a></div></div>
<div class="ttc" id="aclassgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder_html_a2309c1df894c5d1625f5e49cf09d0d8e"><div class="ttname"><a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#a2309c1df894c5d1625f5e49cf09d0d8e">google::cloud::pubsub::v1::MessageBuilder::SetData</a></div><div class="ttdeci">MessageBuilder &amp; SetData(std::string data) &amp;</div><div class="ttdoc">Sets the message payload to data.</div><div class="ttdef"><b>Definition:</b> <a href="message_8h_source.html#l00150">message.h:150</a></div></div>
<div class="ttc" id="aclassgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder_html_ac0c8dd77ea781ac4e226716b5458920d"><div class="ttname"><a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1MessageBuilder.html#ac0c8dd77ea781ac4e226716b5458920d">google::cloud::pubsub::v1::MessageBuilder::Build</a></div><div class="ttdeci">Message Build() &amp;&amp;</div><div class="ttdoc">Creates a new message.</div><div class="ttdef"><b>Definition:</b> <a href="message_8h_source.html#l00147">message.h:147</a></div></div>
<div class="ttc" id="anamespacegoogle_1_1cloud_1_1pubsub_1_1v1_html_a838db478485c19cba0f1e0e08ea30332"><div class="ttname"><a href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a838db478485c19cba0f1e0e08ea30332">google::cloud::pubsub::v1::LimitedTimeRetryPolicy</a></div><div class="ttdeci">google::cloud::internal::LimitedTimeRetryPolicy&lt; pubsub_internal::RetryTraits &gt; LimitedTimeRetryPolicy</div><div class="ttdoc">A retry policy that limits based on time.</div><div class="ttdef"><b>Definition:</b> <a href="retry__policy_8h_source.html#l00049">retry_policy.h:50</a></div></div>
<div class="ttc" id="aclassgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions_html_a4637a68ef22b47bd83936ceff5dc4199"><div class="ttname"><a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions.html#a4637a68ef22b47bd83936ceff5dc4199">google::cloud::pubsub::v1::PublisherOptions::set_maximum_hold_time</a></div><div class="ttdeci">PublisherOptions &amp; set_maximum_hold_time(std::chrono::duration&lt; Rep, Period &gt; v)</div><div class="ttdoc">Sets the maximum hold time for the messages.</div><div class="ttdef"><b>Definition:</b> <a href="publisher__options_8h_source.html#l00070">publisher_options.h:70</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
