<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Google Cloud Pub/Sub C++ Client: google::cloud::pubsub::v1::Publisher Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Google Cloud Pub/Sub C++ Client
   &#160;<span id="projectnumber">1.18.0(Beta)</span>
   </div>
   <div id="projectbrief">A C++ Client Library for Google Cloud Pub/Sub</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacegoogle.html">google</a></li><li class="navelem"><a class="el" href="namespacegoogle_1_1cloud.html">cloud</a></li><li class="navelem"><a class="el" href="namespacegoogle_1_1cloud_1_1pubsub.html">pubsub</a></li><li class="navelem"><a class="el" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html">v1</a></li><li class="navelem"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">google::cloud::pubsub::v1::Publisher Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Publish messages to the Cloud Pub/Sub service.  
 <a href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="publisher_8h_source.html">google/cloud/pubsub/publisher.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:adc81ab4359c06482a7c18c838e175bf1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#adc81ab4359c06482a7c18c838e175bf1">Publisher</a> (std::shared_ptr&lt; <a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherConnection.html">PublisherConnection</a> &gt; connection, <a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions.html">PublisherOptions</a> options={})</td></tr>
<tr class="separator:adc81ab4359c06482a7c18c838e175bf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ccf0e0fb70c6a82754718310344c30a"><td class="memItemLeft" align="right" valign="top">future&lt; StatusOr&lt; std::string &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#a8ccf0e0fb70c6a82754718310344c30a">Publish</a> (<a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Message.html">Message</a> m)</td></tr>
<tr class="memdesc:a8ccf0e0fb70c6a82754718310344c30a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Publishes a message to this publisher's topic.  <a href="#a8ccf0e0fb70c6a82754718310344c30a">More...</a><br /></td></tr>
<tr class="separator:a8ccf0e0fb70c6a82754718310344c30a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9862f588e39e5816574403c7632fbfd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#aa9862f588e39e5816574403c7632fbfd">Flush</a> ()</td></tr>
<tr class="memdesc:aa9862f588e39e5816574403c7632fbfd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flush any unpublished messages.  <a href="#aa9862f588e39e5816574403c7632fbfd">More...</a><br /></td></tr>
<tr class="separator:aa9862f588e39e5816574403c7632fbfd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:ab0dc0f70e5df843780e63d556e450888"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#ab0dc0f70e5df843780e63d556e450888">Publisher</a> (<a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> const &amp;)=default</td></tr>
<tr class="separator:ab0dc0f70e5df843780e63d556e450888"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0cd6e436ef718ec543fd017b4ac5145"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#ad0cd6e436ef718ec543fd017b4ac5145">operator=</a> (<a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> const &amp;)=default</td></tr>
<tr class="separator:ad0cd6e436ef718ec543fd017b4ac5145"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0de1f7f19d30b5c27589f71fb849c245"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#a0de1f7f19d30b5c27589f71fb849c245">Publisher</a> (<a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> &amp;&amp;) noexcept=default</td></tr>
<tr class="separator:a0de1f7f19d30b5c27589f71fb849c245"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44075a2f7938200f8ebf5cd595294b4e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#a44075a2f7938200f8ebf5cd595294b4e">operator=</a> (<a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> &amp;&amp;) noexcept=default</td></tr>
<tr class="separator:a44075a2f7938200f8ebf5cd595294b4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Publish messages to the Cloud Pub/Sub service. </p>
<p>This class is used to publish message to a given topic, with a fixed configuration such as credentials, batching, background threads, etc. Applications that publish messages to multiple topics need to create separate instances of this class. Applications wanting to publish events with different batching configuration also need to create separate instances.</p>
<dl class="section see"><dt>See also</dt><dd><a href="https://cloud.google.com/pubsub">https://cloud.google.com/pubsub</a> for an overview of the Cloud Pub/Sub service.</dd></dl>
<dl class="section user"><dt>Example</dt><dd></dd></dl>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">pubsub</a> = ::google::cloud::pubsub;</div><div class="line"></div><div class="line"><span class="keyword">auto</span> topic = pubsub::Topic(<span class="stringliteral">&quot;my-project&quot;</span>, <span class="stringliteral">&quot;my-topic&quot;</span>);</div><div class="line"><span class="keyword">auto</span> publisher = pubsub::Publisher(<a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a52843c207d3a785cc60eb1631527ad06">MakePublisherConnection</a>(topic));</div><div class="line"><span class="keyword">auto</span> <span class="keywordtype">id</span> = publisher-&gt;Publish(</div><div class="line">    pubsub::MessageBuilder{}.SetData(<span class="stringliteral">&quot;my-data&quot;</span>).Build());</div><div class="line"><span class="keywordtype">id</span>.then([](future&lt;std::string&gt; f) {</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;published with id = &quot;</span> &lt;&lt; f.get() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">});</div></div><!-- fragment --><dl class="section user"><dt>Performance</dt><dd></dd></dl>
<p><code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html" title="Publish messages to the Cloud Pub/Sub service.">Publisher</a></code> objects are relatively cheap to create, copy, and move. However, each <code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html" title="Publish messages to the Cloud Pub/Sub service.">Publisher</a></code> object must be created with a <code>std::shared_ptr&lt;<a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherConnection.html" title="A connection to the Cloud Pub/Sub service to publish events.">PublisherConnection</a>&gt;</code>, which itself is relatively expensive to create. Therefore, connection instances should be shared when possible. See the <code><a class="el" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a52843c207d3a785cc60eb1631527ad06">MakePublisherConnection()</a></code> method and the <code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherConnection.html" title="A connection to the Cloud Pub/Sub service to publish events.">PublisherConnection</a></code> interface for more details.</p>
<dl class="section user"><dt>Thread Safety</dt><dd></dd></dl>
<p>Instances of this class created via copy-construction or copy-assignment share the underlying pool of connections. Access to these copies via multiple threads is guaranteed to work. Two threads operating on the same instance of this class is not guaranteed to work.</p>
<dl class="section user"><dt>Background Threads</dt><dd></dd></dl>
<p>This class uses the background threads configured via <code>ConnectionOptions</code>. Applications can create their own pool of background threads by (a) creating their own <a class="elRef" doxygen="/v/cmake-out/ci-fedora-install-31-clang-tidy/google/cloud/cloud.tag:https://googleapis.dev/google-cloud-common/master/" href="https://googleapis.dev/google-cloud-common/master/classgoogle_1_1cloud_1_1v1_1_1CompletionQueue.html">google::cloud::v1::CompletionQueue</a>, (b) setting this completion queue in <code>pubsub::ConnectionOptions::DisableBackgroundThreads()</code>, and (c) attaching any number of threads to the completion queue.</p>
<dl class="section user"><dt>Example: using a custom thread pool</dt><dd><div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">pubsub</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">google::cloud::pubsub</a>;</div><div class="line">  <span class="keyword">using</span> google::cloud::future;</div><div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div><div class="line">  [](std::string project_id, std::string topic_id) {</div><div class="line">    <span class="comment">// Create our own completion queue to run the background activity, such as</span></div><div class="line">    <span class="comment">// flushing the publisher.</span></div><div class="line">    google::cloud::CompletionQueue cq;</div><div class="line">    <span class="comment">// Setup one or more of threads to service this completion queue. These must</span></div><div class="line">    <span class="comment">// remain running until all the work is done.</span></div><div class="line">    std::vector&lt;std::thread&gt; tasks;</div><div class="line">    std::generate_n(std::back_inserter(tasks), 4, [&amp;cq] {</div><div class="line">      <span class="keywordflow">return</span> std::thread([cq]() <span class="keyword">mutable</span> { cq.Run(); });</div><div class="line">    });</div><div class="line"></div><div class="line">    <span class="keyword">auto</span> topic = pubsub::Topic(std::move(project_id), std::move(topic_id));</div><div class="line">    <span class="keyword">auto</span> publisher = pubsub::Publisher(<a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a52843c207d3a785cc60eb1631527ad06">pubsub::MakePublisherConnection</a>(</div><div class="line">        std::move(topic), pubsub::PublisherOptions{},</div><div class="line">        <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a6833bef0c593e2cfde6e1c9f2d745b94">pubsub::ConnectionOptions</a>{}.DisableBackgroundThreads(cq)));</div><div class="line"></div><div class="line">    std::vector&lt;future&lt;void&gt;&gt; ids;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">char</span> <span class="keyword">const</span>* data : {<span class="stringliteral">&quot;1&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>, <span class="stringliteral">&quot;3&quot;</span>, <span class="stringliteral">&quot;go!&quot;</span>}) {</div><div class="line">      ids.push_back(</div><div class="line">          publisher.Publish(pubsub::MessageBuilder().SetData(data).Build())</div><div class="line">              .then([data](future&lt;StatusOr&lt;std::string&gt;&gt; f) {</div><div class="line">                <span class="keyword">auto</span> s = f.get();</div><div class="line">                <span class="keywordflow">if</span> (!s) <span class="keywordflow">return</span>;</div><div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;Sent &#39;&quot;</span> &lt;&lt; data &lt;&lt; <span class="stringliteral">&quot;&#39; (&quot;</span> &lt;&lt; *s &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line">              }));</div><div class="line">    }</div><div class="line">    publisher.Flush();</div><div class="line">    <span class="comment">// Block until they are actually sent.</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <span class="keywordtype">id</span> : ids) <span class="keywordtype">id</span>.get();</div><div class="line"></div><div class="line">    <span class="comment">// Shutdown the completion queue and join the threads</span></div><div class="line">    cq.Shutdown();</div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; t : tasks) <a class="codeRef" doxygen="/v/cmake-out/ci-fedora-install-31-clang-tidy/google/cloud/cloud.tag:https://googleapis.dev/google-cloud-common/master/" href="https://googleapis.dev/google-cloud-common/master/log_8cc.html#abc5627fb346314b5f14b10bdb6542da7">t</a>.join();</div><div class="line">  }</div></div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>Asynchronous Functions</dt><dd></dd></dl>
<p>Some of the member functions in this class return a <code>future&lt;T&gt;</code> (or <code>future&lt;StatusOr&lt;T&gt;&gt;</code>) object. Readers are probably familiar with <a href="https://en.cppreference.com/w/cpp/thread/future"><code>std::future&lt;T&gt;</code></a>. Our version adds a <code>.then()</code> function to attach a callback to the future, which is invoked when the future is satisfied. This function returns a <code>future&lt;U&gt;</code> where <code>U</code> is the return value of the attached function. More details in the <a class="elRef" doxygen="/v/cmake-out/ci-fedora-install-31-clang-tidy/google/cloud/cloud.tag:https://googleapis.dev/google-cloud-common/master/" href="https://googleapis.dev/google-cloud-common/master/classgoogle_1_1cloud_1_1v1_1_1future.html">google::cloud::v1::future</a> documentation.</p>
<dl class="section user"><dt>Error Handling</dt><dd></dd></dl>
<p>This class uses <code>StatusOr&lt;T&gt;</code> to report errors. When an operation fails to perform its work the returned <code>StatusOr&lt;T&gt;</code> contains the error details. If the <code>ok()</code> member function in the <code>StatusOr&lt;T&gt;</code> returns <code>true</code> then it contains the expected result. Please consult the <a class="elRef" doxygen="/v/cmake-out/ci-fedora-install-31-clang-tidy/google/cloud/cloud.tag:https://googleapis.dev/google-cloud-common/master/" href="https://googleapis.dev/google-cloud-common/master/classgoogle_1_1cloud_1_1v1_1_1StatusOr.html">google::cloud::v1::StatusOr</a> documentation for more details.</p>
<dl class="section user"><dt>Batching Configuration Example</dt><dd><div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">pubsub</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">google::cloud::pubsub</a>;</div><div class="line">  <span class="keyword">using</span> google::cloud::future;</div><div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div><div class="line">  [](std::string project_id, std::string topic_id) {</div><div class="line">    <span class="keyword">auto</span> topic = pubsub::Topic(std::move(project_id), std::move(topic_id));</div><div class="line">    <span class="comment">// By default the publisher will flush a batch after 10ms, after it contains</span></div><div class="line">    <span class="comment">// more than 100 message, or after it contains more than 1MiB of data,</span></div><div class="line">    <span class="comment">// whichever comes first. This changes those defaults.</span></div><div class="line">    <span class="keyword">auto</span> publisher = pubsub::Publisher(<a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a52843c207d3a785cc60eb1631527ad06">pubsub::MakePublisherConnection</a>(</div><div class="line">        std::move(topic),</div><div class="line">        pubsub::PublisherOptions{}</div><div class="line">            .set_maximum_hold_time(std::chrono::milliseconds(20))</div><div class="line">            .set_maximum_batch_bytes(4 * 1024 * 1024L)</div><div class="line">            .set_maximum_message_count(200),</div><div class="line">        <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a6833bef0c593e2cfde6e1c9f2d745b94">pubsub::ConnectionOptions</a>{}));</div><div class="line"></div><div class="line">    std::vector&lt;future&lt;void&gt;&gt; ids;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">char</span> <span class="keyword">const</span>* data : {<span class="stringliteral">&quot;1&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>, <span class="stringliteral">&quot;3&quot;</span>, <span class="stringliteral">&quot;go!&quot;</span>}) {</div><div class="line">      ids.push_back(</div><div class="line">          publisher.Publish(pubsub::MessageBuilder().SetData(data).Build())</div><div class="line">              .then([data](future&lt;StatusOr&lt;std::string&gt;&gt; f) {</div><div class="line">                <span class="keyword">auto</span> s = f.get();</div><div class="line">                <span class="keywordflow">if</span> (!s) <span class="keywordflow">return</span>;</div><div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;Sent &#39;&quot;</span> &lt;&lt; data &lt;&lt; <span class="stringliteral">&quot;&#39; (&quot;</span> &lt;&lt; *s &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line">              }));</div><div class="line">    }</div><div class="line">    publisher.Flush();</div><div class="line">    <span class="comment">// Block until they are actually sent.</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <span class="keywordtype">id</span> : ids) <span class="keywordtype">id</span>.get();</div><div class="line">  }</div></div><!-- fragment --></dd></dl>

<p class="definition">Definition at line <a class="el" href="publisher_8h_source.html#l00103">103</a> of file <a class="el" href="publisher_8h_source.html">publisher.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="adc81ab4359c06482a7c18c838e175bf1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc81ab4359c06482a7c18c838e175bf1">&#9670;&nbsp;</a></span>Publisher() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">google::cloud::pubsub::v1::Publisher::Publisher </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherConnection.html">PublisherConnection</a> &gt;&#160;</td>
          <td class="paramname"><em>connection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions.html">PublisherOptions</a>&#160;</td>
          <td class="paramname"><em>options</em> = <code>{}</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="publisher_8cc_source.html#l00024">24</a> of file <a class="el" href="publisher_8cc_source.html">publisher.cc</a>.</p>

</div>
</div>
<a id="ab0dc0f70e5df843780e63d556e450888"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0dc0f70e5df843780e63d556e450888">&#9670;&nbsp;</a></span>Publisher() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">google::cloud::pubsub::v1::Publisher::Publisher </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> const &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a0de1f7f19d30b5c27589f71fb849c245"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0de1f7f19d30b5c27589f71fb849c245">&#9670;&nbsp;</a></span>Publisher() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">google::cloud::pubsub::v1::Publisher::Publisher </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> &amp;&amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aa9862f588e39e5816574403c7632fbfd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9862f588e39e5816574403c7632fbfd">&#9670;&nbsp;</a></span>Flush()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void google::cloud::pubsub::v1::Publisher::Flush </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Flush any unpublished messages. </p>
<p>As applications can configure a <code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html" title="Publish messages to the Cloud Pub/Sub service.">Publisher</a></code> to buffer messages, it is sometimes useful to flush them before any of the normal criteria to send the RPCs is met.</p>
<dl class="section user"><dt>Example</dt><dd><div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">pubsub</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">google::cloud::pubsub</a>;</div><div class="line">  <span class="keyword">using</span> google::cloud::future;</div><div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div><div class="line">  [](pubsub::Publisher publisher) {</div><div class="line">    std::vector&lt;future&lt;void&gt;&gt; done;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i != 10; ++i) {</div><div class="line">      <span class="keyword">auto</span> message_id = publisher.Publish(</div><div class="line">          pubsub::MessageBuilder{}</div><div class="line">              .SetData(<span class="stringliteral">&quot;Hello World! [&quot;</span> + std::to_string(i) + <span class="stringliteral">&quot;]&quot;</span>)</div><div class="line">              .SetAttributes({{<span class="stringliteral">&quot;origin&quot;</span>, <span class="stringliteral">&quot;cpp-sample&quot;</span>}, {<span class="stringliteral">&quot;username&quot;</span>, <span class="stringliteral">&quot;gcp&quot;</span>}})</div><div class="line">              .Build());</div><div class="line">      done.push_back(message_id.then([i](future&lt;StatusOr&lt;std::string&gt;&gt; f) {</div><div class="line">        auto id = f.get();</div><div class="line">        if (!id) throw std::runtime_error(id.status().message());</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Message &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; published with id=&quot;</span> &lt;&lt; *id &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">      }));</div><div class="line">    }</div><div class="line">    publisher.Flush();</div><div class="line">    <span class="comment">// Block until all the messages are published (optional)</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; f : done) f.get();</div><div class="line">  }</div></div><!-- fragment --> </dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function does not return any status or error codes, the application can use the <code>future&lt;StatusOr&lt;std::string&gt;&gt;</code> returned in each <code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html#a8ccf0e0fb70c6a82754718310344c30a" title="Publishes a message to this publisher&#39;s topic.">Publish()</a></code> call to find out what the results are. </dd></dl>

<p class="definition">Definition at line <a class="el" href="publisher_8h_source.html#l00156">156</a> of file <a class="el" href="publisher_8h_source.html">publisher.h</a>.</p>

</div>
</div>
<a id="ad0cd6e436ef718ec543fd017b4ac5145"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0cd6e436ef718ec543fd017b4ac5145">&#9670;&nbsp;</a></span>operator=() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a>&amp; google::cloud::pubsub::v1::Publisher::operator= </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> const &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a44075a2f7938200f8ebf5cd595294b4e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44075a2f7938200f8ebf5cd595294b4e">&#9670;&nbsp;</a></span>operator=() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a>&amp; google::cloud::pubsub::v1::Publisher::operator= </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html">Publisher</a> &amp;&amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a8ccf0e0fb70c6a82754718310344c30a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ccf0e0fb70c6a82754718310344c30a">&#9670;&nbsp;</a></span>Publish()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">future&lt;StatusOr&lt;std::string&gt; &gt; google::cloud::pubsub::v1::Publisher::Publish </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Message.html">Message</a>&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Publishes a message to this publisher's topic. </p>
<p>Note that the message may be batched based on the <a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1Publisher.html" title="Publish messages to the Cloud Pub/Sub service.">Publisher</a>'s configuration. It could be delayed until the batch has enough messages, or enough data, or enough time has elapsed. See the <code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions.html" title="Configuration options for a Publisher.">PublisherOptions</a></code> documentation for more details.</p>
<dl class="section user"><dt>Idempotency</dt><dd>This is a non-idempotent operation. By default the request is <em>not</em> retried if there is a transient error. Applications wanting to retry requests can do so by enabling the <code>retry_publish_failures()</code> parameter in the <code><a class="el" href="classgoogle_1_1cloud_1_1pubsub_1_1v1_1_1PublisherOptions.html" title="Configuration options for a Publisher.">PublisherOptions</a></code>.</dd></dl>
<dl class="section user"><dt>Example</dt><dd><div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">pubsub</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">google::cloud::pubsub</a>;</div><div class="line">  <span class="keyword">using</span> google::cloud::future;</div><div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div><div class="line">  [](pubsub::Publisher publisher) {</div><div class="line">    <span class="keyword">auto</span> message_id = publisher.Publish(</div><div class="line">        pubsub::MessageBuilder{}.SetData(<span class="stringliteral">&quot;Hello World!&quot;</span>).Build());</div><div class="line">    <span class="keyword">auto</span> done = message_id.then([](future&lt;StatusOr&lt;std::string&gt;&gt; f) {</div><div class="line">      <span class="keyword">auto</span> <span class="keywordtype">id</span> = f.get();</div><div class="line">      <span class="keywordflow">if</span> (!<span class="keywordtype">id</span>) <span class="keywordflow">throw</span> std::runtime_error(<span class="keywordtype">id</span>.status().message());</div><div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Hello World! published with id=&quot;</span> &lt;&lt; *<span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">    });</div><div class="line">    <span class="comment">// Block until the message is published</span></div><div class="line">    done.get();</div><div class="line">  }</div></div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>Changing Retry Parameters Example</dt><dd><div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">pubsub</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub.html">google::cloud::pubsub</a>;</div><div class="line">  <span class="keyword">using</span> google::cloud::future;</div><div class="line">  <span class="keyword">using</span> google::cloud::StatusOr;</div><div class="line">  [](std::string project_id, std::string topic_id) {</div><div class="line">    <span class="keyword">auto</span> topic = pubsub::Topic(std::move(project_id), std::move(topic_id));</div><div class="line">    <span class="comment">// By default a publisher will retry for 60 seconds, with an initial backoff</span></div><div class="line">    <span class="comment">// of 100ms, a maximum backoff of 60 seconds, and the backoff will grow by</span></div><div class="line">    <span class="comment">// 30% after each attempt. This changes those defaults.</span></div><div class="line">    <span class="keyword">auto</span> publisher = pubsub::Publisher(<a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a52843c207d3a785cc60eb1631527ad06">pubsub::MakePublisherConnection</a>(</div><div class="line">        std::move(topic),</div><div class="line">        pubsub::PublisherOptions{}.enable_retry_publish_failures(), {},</div><div class="line">        <a class="code" href="namespacegoogle_1_1cloud_1_1pubsub_1_1v1.html#a838db478485c19cba0f1e0e08ea30332">pubsub::LimitedTimeRetryPolicy</a>(</div><div class="line">            <span class="comment">/*maximum_duration=*/</span>std::chrono::minutes(10))</div><div class="line">            .clone(),</div><div class="line">        pubsub::ExponentialBackoffPolicy(</div><div class="line">            <span class="comment">/*initial_delay=*/</span>std::chrono::milliseconds(200),</div><div class="line">            <span class="comment">/*maximum_delay=*/</span>std::chrono::seconds(45),</div><div class="line">            <span class="comment">/*scaling=*/</span>2.0)</div><div class="line">            .clone()));</div><div class="line"></div><div class="line">    std::vector&lt;future&lt;bool&gt;&gt; done;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">char</span> <span class="keyword">const</span>* data : {<span class="stringliteral">&quot;1&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>, <span class="stringliteral">&quot;3&quot;</span>, <span class="stringliteral">&quot;go!&quot;</span>}) {</div><div class="line">      done.push_back(</div><div class="line">          publisher.Publish(pubsub::MessageBuilder().SetData(data).Build())</div><div class="line">              .then([](future&lt;StatusOr&lt;std::string&gt;&gt; f) {</div><div class="line">                <span class="keywordflow">return</span> f.get().ok();</div><div class="line">              }));</div><div class="line">    }</div><div class="line">    publisher.Flush();</div><div class="line">    <span class="keywordtype">int</span> count = 0;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; f : done) {</div><div class="line">      <span class="keywordflow">if</span> (f.get()) ++count;</div><div class="line">    }</div><div class="line">    std::cout &lt;&lt; count &lt;&lt; <span class="stringliteral">&quot; messages sent successfully\n&quot;</span>;</div><div class="line">  }</div></div><!-- fragment --> </dd></dl>
<dl class="section return"><dt>Returns</dt><dd>a future that becomes satisfied when the message is published or on a unrecoverable error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="publisher_8h_source.html#l00138">138</a> of file <a class="el" href="publisher_8h_source.html">publisher.h</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
